<html>
<head>
  <title>API</title>
  <link rel="stylesheet" href="assets/javascripts/normalize.css" />
  <link rel="stylesheet" href="assets/stylesheets/customize.css" />

  <script src="http://code.jquery.com/jquery-1.6.2.min.js"></script>
  <script src="http://cdn.jquerytools.org/1.2.5/full/jquery.tools.min.js"></script>
  <script src="assets/javascripts/jquery.jqote2.min.js"></script>
  <script src="assets/javascripts/quicksearch.js"></script>
  <script>
    String.prototype.escapeHTML = function () {
      return(                                                                 
        this.replace(/\&/g,'&amp;').                                
             replace(/\>/g,'&gt;').
             replace(/\</g,'&lt;').
             replace(/\"/g,'&quot;')
      );                                          
    };
  </script>

  <script>
    $(document).ready(function(){

      $.getJSON('shomen.json', function(data) {

        metadata = data['(metadata)'];

        $('#header').append(
          $('#template-header').jqote(metadata)
        );

        var table = new Array();
        $.each(data, function(key, value) {
          value.key = cleanId(key);
          table.push(value);
        });

        table.sort(compareNames);

        $.each(table, function(index, value) {
          type  = value['!'];
          switch(type) {
          case 'function':
            $('#methods').append(
              $('#template-method-link').jqote(value)
            );
            $('#infobox').append(
              $('#template-method-info').jqote(value)
            );
            break;
          case 'method':
            $('#methods').append(
              $('#template-method-link').jqote(value)
            );
            $('#infobox').append(
              $('#template-method-info').jqote(value)
            );
            break;
          case 'class':
            $('#classes').append(
              $('#template-module-link').jqote(value)
            );
            $('#infobox').append(
              $('#template-module-info').jqote(value)
            );
            break;
          case 'module':
            $('#classes').append(
              $('#template-module-link').jqote(value)
            );
            $('#infobox').append(
              $('#template-module-info').jqote(value)
            );
            break;
          case 'file':
            $('#files').append(
              $('#template-file-link').jqote(value)
            );
            $('#infobox').append(
              $('#template-file-info').jqote(value)
            );
            break;
          case 'script':
            $('#files').append(
              $('#template-file-link').jqote(value)
            );
            $('#infobox').append(
              $('#template-script-info').jqote(value)
            );
            break;
          };

        });

        $('#api-file-README_rdoc').show();

        $(".scroll").scrollable({mousewheel: true}).navigator();

        $('input#search-input').quicksearch('.items li', {
          'bind': 'change',
        });
      });

      $('#abctabs').append(
        $('#template-abctabs').jqote()
      );

    });

    function toggleBox(boxId) {
      boxId = boxId.replace(/[.,?!\s]/g, "_"); 
      $('.box').hide();
      $(boxId).toggle();
    };

    function cleanId(anId) {
      anId = anId.replace(/\W+/g, "_");
      return(anId);
    };

    //
    function sortObj(arr){
	    // Setup Arrays
	    var sortedKeys = new Array();
	    var sortedObj = {};
	    // Separate keys and sort them
	    for (var i in arr){
		    sortedKeys.push(i);
	    }
	    sortedKeys.sort();
	    // Reconstruct sorted obj based on keys
	    for (var i in sortedKeys){
		    sortedObj[sortedKeys[i]] = arr[sortedKeys[i]];
	    }
	    return sortedObj;
    };

    //
    function compareNames(a, b){
      if (a.name < b.name) {return -1}
      if (a.name > b.name) {return 1}
      return 0;
    };

    //
    function showRaw(){
      $.getJSON('shomen.json', function(data) {
        $('#raw').append(recursive_parse(data));
      });
    };

    //
    function recursive_parse(data) {
      var html = '<ul>';
      for (var k in data) {
        if (data[k] instanceof Object) {
          html = html + '<li>' + k + ' ' + recursive_parse(data[k]);
        } else {
          html = html + '<li>' + k + ' <code>' + ('' + data[k]).escapeHTML() + '</code>';
        }
        html = html + '</li>';
      }
      html = html + '</ul>';
      return html;
    };

    function clickABCTab(letter) {
      $("input#search-input").val(letter).trigger('change');
    };

  </script>
</head>

<body>
  <div id="header">
    <div class="raw-button"><button onclick="showRaw();">raw</button></div>
  </div>

  <div id="ribbon">
    <table width="100%">
    <tr>
      <th>Search</th>
      <td>
        <div id="search-field">
          <input id="search-input" type="text" value="" /> &nbsp;
          <span id="abctabs">
          </span>
        </div>
      </td>
    </tr> <tr>
      <th style="width: 50px;">FILES</th>
      <td>
        <div class="scroll">
          <ul id="files" class="items"></ul>
        </div>
      </td>
    </tr> <tr>
      <th style="width: 50px;">CONSTANTS</th>
      <td>
        <div class="scroll">
          <ul id="classes" class="items"></ul>
        </div>
      </td>
    </tr> <tr>
      <th style="width: 50px;">METHODS</th>
      <td>
        <div class="scroll">
          <ul id="methods" class="items"></ul>
        </div>
      </td>
    </tr>
    </table>
  </div>

  <div id="infobox">
  </div>

  <div id="raw">
  </div>

</body>
</html>

<!-- TEMPLATES -->

<!-- HEADER -->

<script type="text/x-jqote-template" id="template-header">
  <![CDATA[
    <h1><%= this.title %></h1>
    <h2><%= this.summary %></h2>
  ]]>
</script>

<script type="text/x-jqote-template" id="template-abctabs">
  <![CDATA[
    <% abc = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'; %>
    <% for (i=0;i<=25;i++) { %>
      <button class="letter" onclick="clickABCTab('<%= abc[i] %>');"><%= abc[i] %></button>
    <% } %>
    <button class="letter" onclick="clickABCTab('');">(clear)</button>
  ]]>
</script>

<!-- METHOD -->

<script type="text/x-jqote-template" id="template-method-link">
  <![CDATA[
    <li>
      <button class="link" onclick="toggleBox('#api-method-<%= this.key %>');">
        <%= this.name %>
      </button>
    </li>
  ]]>
</script>

<script type="text/x-jqote-template" id="template-method-info">
  <![CDATA[
    <div class="box" id="api-method-<%= this.key %>" style="display: none;">
      <div style="float: right">
        <button class="link" onclick="$('#api-method-<%= this.key %>').hide();">X</button>
      </div>
      <div class="info-heading">
        <h2><%= this['!'] %></h2>
        <h1><span class="fade"><%= this.parent %></span>#<%= this.name %><h1>
        <h3></h3>
      </div>
      <div class="info-content">
        <p><%= this.comment %></p>
      <div>
    </div>
  ]]>
</script>

<!-- MODULE -->

<script type="text/x-jqote-template" id="template-module-link">
  <![CDATA[
    <li>
      <button class="link" onclick="toggleBox('#api-module-<%= this.key %>');"
          title="<%= this.namespace + '::' + this.name %>"
            alt="<%= this.namespace + '::' + this.name %>">
        <%= this.name %>
      </button>
    </li>
  ]]>
</script>

<script type="text/x-jqote-template" id="template-module-info">
  <![CDATA[
    <div class="box" id="api-module-<%= this.key %>" style="display: none;">
      <div style="float: right">
        <button class="link" onclick="$('#api-module-<%= this.key %>').hide();">X</button>
      </div>

      <div class="info-heading">
        <h2><%= this['!'] %></h2>
        <h1>
        <span class="fade"><%= this.namespace %></span>::<%= this.name %>
        <% if (this['!'] == 'class'){ %>
          <span class="fade">< <%= this.superclass || 'Object' %></span>
        <% }else{ %>
          <span class="fade"></span>
        <% } %>
        </h1>
        <h3></h3>
      </h2>
      <div class="info-content">
        <p><%= this.comment.escapeHTML() %></p>
      </div>
    </div>
  ]]>
</script>

<!-- FILE -->

<script type="text/x-jqote-template" id="template-file-link">
  <![CDATA[
    <li>
      <button class="link" onclick="toggleBox('#api-file-<%= this.key %>');">
        <%= this.name %>
      </button>
    </li>
  ]]>
</script>

<script type="text/x-jqote-template" id="template-file-info">
  <![CDATA[
    <div class="box" id="api-file-<%= this.key %>" style="display: none;">
      <div style="float: right">
        <button class="link" onclick="$('#api-file-<%= this.key %>').hide();">X</button>
      </div>
      <div class="info-heading">
        <h2>file</h2>
        <h1><%= this.path %> <!-- <%= this.name %> --> </h1>
        <h3><%= this.mtime %></h3>
      </div>
      <div class="info-content">
        <pre><%= this.text.escapeHTML() %></pre>
      </div>
    </div>
  ]]>
</script>

<script type="text/x-jqote-template" id="template-script-info">
  <![CDATA[
    <div class="box" id="api-file-<%= this.key %>" style="display: none;">
      <div style="float: right">
        <button class="link" onclick="$('#api-file-<%= this.key %>').hide();">X</button>
      </div>
      <div class="info-heading">
        <h2>script</h2>
        <h1><%= this.path %></h1>
        <h3><%= this.mtime %></h3>
      </h2>
      <div class="info-content">
        <pre><%= this.source.escapeHTML() %></pre>
    </div>
  ]]>
</script>

